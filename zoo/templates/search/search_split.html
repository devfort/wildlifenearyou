{% extends base %}

{% block title %}Search: {% if what %}&ldquo;{{ what }}&rdquo;{% else %}Everything{% endif %} near &ldquo;{{ near }}&rdquo;{% endblock %}

{% block search_form %}{% endblock %}

{% block primary_content %}
<h1>Search: {% if what %}&ldquo;{{ what }}&rdquo;{% else %}Everything{% endif %} near &ldquo;{{ near }}&rdquo;</h1>

<form action="/search/" method="GET">
    <div class="container text-container">
        <input type="text" name="what" value="{% if what %}{{ what }}{% else %}Everything{% endif %}" size="20"{% if not what %} class="remove-default"{% endif %}>
        near <input type="text" name="near" value="{{ near }}" size="25">
        <input type="submit" value="Search">
    </div>
</form>

{% if not results %}
<p>I&rsquo;m afraid your search returned no results. Try something else?</p>
{% if request.user.is_staff %}
    <p>If you&rsquo;re a developer, try running <samp>./manage.py reindex_places</samp></p>
{% endif %}
{% endif %}

{% if results and results_corrected_q %}

<div class="information">
We couldn&rsquo;t find any results for {{ q }}, so we thought you might like these results for &ldquo;{{ results_corrected_q }}&rdquo;.
</div>

{% endif %}

{% if results %}
    <ol>
    {% for place in results %}
        <li>
            <h4><a href="{{ place.get_absolute_url }}">{{ place }}</a>, {{ place.country }} <a href="{{ place.country.get_absolute_url }}" class="flag"><img width="16" height="11" src="/static/img/flags/{{ place.country.country_code }}.gif" alt="Flag of {{ place.country }}"></a>
            {% if place.distance %}{{ place.distance_miles|floatformat:0 }} mile{{ place.distance_miles|pluralize }} away{% endif %}
            </h4>
            {% if place.address %}<p>{{ place.address }}</p>{% endif %}
            {% if place.species_list %}
            <ul class="species_list">
            {% for species in place.species_list %}
            	<li><span class="cloud-quad-{{ species.quad }}" title="{{ species.count }} seen"><a href="{% filter lower %}{% url place-species-view place.country.country_code,place.slug,species.slug %}{% endfilter %}"{% if species.matches_search %} style="color: red"{% endif %}>{{ species.common_name }}</a></span></li>
            {% endfor %}
            </ul>
            {% endif %}
        </li>
    {% endfor %}
    </ol>
{% endif %}
{% if request.user.is_staff %}
    <h4><a class="toggler" href="#debug-results">Debug info (developers only)</a></h4>
    <pre id="debug-results" style="font-size:0.85em">{{ results_info }}</pre>
{% endif %}

{% endblock %}

{% block secondary_content %}

{% if species_results %}
    <h4>Matching species</h4>
    <ol>
    {% for result in species_results %}
        <li><a href="{{ result.get_absolute_url }}">{{ result.common_name }}</a> <i class="scientific">{{ result.latin_name }}</i></li>
    {% endfor %}
    </ol>
{% endif %}
{% if request.user.is_staff %}
    <h4><a class="toggler" href="#debug-species-results">Debug info (developers only)</a></h4>
    <pre id="debug-species-results" style="font-size:0.85em">{{ species_results_info }}</pre>
{% endif %}

{% endblock %}
