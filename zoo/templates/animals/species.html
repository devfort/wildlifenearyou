{% extends base %}

{% load humanize %}
{% load favourites_extras %}
{% load thumbnail %}

{% block title %}{{ species.common_name }} ({{ species.latin_name }}){% endblock %}

{% block extra_head %}
<script type="text/javascript" src="/static/js/gallery.js"></script>
{% endblock %}

{% block content_title %}
<h1>{{ species.common_name }} <i class="scientific">({{ species.latin_name }})</i></h1>
{% endblock %}

{% block primary_content %}

{% if species.description %}
<p class="intro">{{ species.description }}</p>
{% endif %}

{% if nearest %}
<p>The nearest {{ species.common_name }} to you is at <a href="{{ nearest.get_absolute_url }}">{{ nearest }}</a>, {{ nearest.distance_miles|floatformat:0 }} mile{{ nearest.distance_miles|pluralize }} away from {{ location_description }}. (Is that not where you are? <a href="/set-location/" title="Change your location, currently &quot;{{ location_description }}&quot;">Change your current location</a>.)</p>
{% else %}
{% if not location_description %}
<p>
        {% if user.is_authenticated %}
        <a href="/set-location/">Set your location</a>
        {% else %}
        <a href="{% url accounts-login %}?next={{ request.path }}">Login</a> or <a href="{% url accounts-register %}">register</a>
        {% endif %}
         to find {{ species.article }} {{ species.common_name }} near you (or just <a href="/search/?q={{ species.common_name|iriencode }}">search for one</a>).</p>
{% endif %}
{% endif %}

{% if species.seen_at %}
<h2>See them here</h2>
<ul class="place-list">
    {% for place in species.seen_at %}
    <li>
            {% include "places/_place.html" %}
    </li>
    {% endfor %}
</ul>
{% endif %}

{% if spotters %}
<h2>Spotted by</h2>
<ul class="spotter-list">
{% for spotter in spotters %}
        <li>
                <img src="/faces/medium/{{ spotter.username }}.png" width="75" height="75" alt="" class="pull-left">
                <p><a class="spotter-name" href="{{ spotter.get_profile.urls.absolute }}">{{ spotter }}</a></p>
{% comment %}                <p class="meta">({{ trip.species.count }} sighting{{ trip.species.count|pluralize }})</p>{% endcomment %}
        </li>
{% endfor %}
</ul>
{% if more_spotters %}
<p><a href='{{ species.urls.spotters }}'>See all spottersâ€¦</a></p>
{% endif %}
{% endif %}

{% endblock %}

{% block secondary_content %}

<h2>Favourite</h2>

{% if request.user.is_authenticated %}
	{% if favourited %}
	<p>This is one of your favourite animals! {% favourite_toggler "remove" species.slug request.path %}</p>
	{% else %}
	<p class="add">{% favourite_toggler "add" species.slug request.path %}</p>
	{% endif %}
{% else %}
	<p><a href="{% url accounts-login %}?next={{ request.path }}">Login</a> or <a href="{% url accounts-register %}">register</a> to add this animal as one of your favourites.</p>
{% endif %}

<!-- TODO add in profile icons here of people who have favourited it -->
<p>Favourited by <strong>{{ favourites }}</strong> {{ favourites|pluralize:"person,people" }}{% if hit_parade %}
        &mdash; currently the <a href="{% url popular %}">{{ hit_parade|ordinal }} most favourited animal</a>{% endif %}.</p>

{% with species.visible_photos.count as visible_photo_count %}
	{% if visible_photo_count %}
                <h2>Photos</h2>
		{% ifequal visible_photo_count 1 %}{# Only one photo #}
			<div class="gallery">
			{% for photo in species.visible_photos.all %}
				<a href="{% url photo photo.created_by.username,photo.id %}"><img src="{% thumbnail photo.photo 150x1000 %}"></a>
			{% endfor %}
			</div>
		{% else %}{# More than one photo #}
		{% with species.photo as chosen %}
		<div class="gallery">
        		<a href="{% url photo chosen.created_by.username,chosen.id %}"><img src="{% thumbnail chosen.photo 150x1000 %}"></a>
        		<div class="slideshow">
        			<ul id="thumbnails">
			                {% for photo in species.visible_photos|slice:":30" %}
			                {% ifnotequal chosen photo %}
        		                <li><a href="{% url photo photo.created_by.username,photo.id %}"><img src="{% thumbnail photo.photo 75x75 crop %}"></a></li>
        		                {% endifnotequal %}
			                {% endfor %}
			        </ul><!-- /#thumbnails -->
		        </div><!-- /.slideshow -->
	        </div>
	        {% endwith %}
		{% endifequal %}
	{% endif %}
{% endwith %}

<h2>Comments</h2>
{% with species as object %}
    {% include "comments/_comments.html" %}
{% endwith %}

{% endblock %}
