{% extends "base.html" %}

{% block title %}Moderation overview{% endblock %}

{% block content %}

<h1>Moderation overview</h1>

<dl>
	<dt>Number of pending change groups</dt>
	<dd>{{ change_request_groups|length }}</dd>

	<dt>Total number of change requests<dt>
	<dd>{{ total_change_requests }}</dd>
</dl>

{% if change_request_groups %}
	<h2>Queue</h2>

	<ol>
	{% for crg in change_request_groups %}
		{% with crg.changerequest_set.all as cr %}
			<li>
			{{ cr|length }} change{{ cr|pluralize }} requested by <a href="{% url accounts-profile crg.created_by %}">{{ crg.created_by|title }}</a> {{ crg.created_at|timesince }} ago:

			<ul>
			{% for cr in crg.changerequest_set.all %}
			{% with cr.get_real as crs %}
				<li>
					{% switch cr.subclass %}
						{% case "ChangeAttributeRequest" %}
							Change &ldquo;{{ crs.attribute }}&rdquo;
								on the <em>{{ crs.content_object }}</em> {{ crs.content_type }}
								from &ldquo;<em>{{ crs.old_value }}</em>&rdquo; &rarr; &ldquo;<em>{{ crs.new_value }}</em>&rdquo;

							<form action="." method="post">
								<input type="hidden" name="changerequest_id" value="{{ cr.pk }}"/>
								<input type="submit" name="action" value="Apply"/>
								<input type="submit" name="action" value="Delete"/>
							</form>
						{% endcase %}

						{% defaultcase %}
							<strong>FIXME:</strong> Unknown/unhandled ChangeRequest subclass
						{% enddefaultcase %}

					{% endswitch %}

					{% if crs.is_conflict %}
						<strong>(conflicts)</strong>
					{% endif %}
				</li>

			{% endwith %}
			{% endfor %}
			</ul>

			</li>
		{% endwith %}
	{% endfor %}
	</ol>
{% endif %}

{% endblock %}
