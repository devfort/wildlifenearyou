{% extends base %}

{% block title %}{{ trip.title }}{% endblock %}

{% block extra_head %}
<script type="text/javascript" src="/static/js/star-select-replace.js"></script>
{% endblock %}

{% block content %}

<h1>{{ trip.compact_title }}</h1>
{% with trip.sightings.all as sightings %}
        {% regroup sightings by place.known_as as sightings_by_place %}
    
    
    <!-- TODO: Users should see their OWN photos even if they have not 
        yet been moderated, with a visual indication of this e.g. red border
    -->
    {% with trip.visible_photos.all as photos %}
    {% if photos %}
    <h2>Photos from this trip</h2>
    <div>
    {% for photo in photos %}
    <a href="{{ photo.urls.absolute }}" title="{{ photo.title }}">{{ photo.photo.thumbnail_tag }}</a> by <a href="{{ photo.created_by.get_profile.urls.absolute }}">{{ photo.created_by|title }}</a>
    </div>
    {% endfor %}
    <h2>Got any more?</h2>
    {% else %}
    <h2>Take any photos?</h2>
    {% endif %}
    {% endwith %}
    <form enctype="multipart/form-data" action="{{ request.path }}upload/" method="POST">
        <p><input type="file" name="photo" id="id_photo"> <input type="submit" value="Upload"></p>
    </form>

        {% with sightings_by_place|length as sl %}
        {% ifequal 1 sl %}
                <p>A trip to {% for place in sightings_by_place %}{% for sighting in place.list|slice:":1" %}           
                        <a href="{% url place sighting.place.country.country_code,sighting.place.slug %}">{{ place.grouper }}</a>
                {% endfor %}{% endfor %} with {{ trip.sightings.all.count }} sighting{{ trip.sightings.all.count|pluralize }}</p>

                <p class="description">
                {{ trip.description }}
                </p>

                {% for place in sightings_by_place %}
                        <h2>Sighting{{ trip.sightings.all.count|pluralize }}</h2>
                        <ul>
                                {% for sighting in place.list %}
                                        <li><a href="{% url place-species-view sighting.place.country.country_code,sighting.place.slug,sighting.species.slug %}">{{ sighting.species.common_name }}</a></li>
                                {% endfor %}
                        </ul>
                {% endfor %}
        {% else %}
                <p>A trip with {{ trip.sightings.all.count }} sighting{{ trip.sightings.all.count|pluralize }}</p>

                <p class="description">
                {{ trip.description }}
                </p>

                <h2>Sightings</h2>
                {% for place in sightings_by_place %}
                        <h3>{% for sighting in place.list|slice:":1" %}<a href="{% url place sighting.place.country.country_code,sighting.place.slug %}">{{ place.grouper }}</a>
                {% endfor %}</h3>
                <p>({{ place.list|length }} sighting{{ place.list|length|pluralize }})</p>

                <ul>
                        {% for sighting in place.list %}
                        <li><a href="{% url place-species-view sighting.place.country.country_code,sighting.place.slug,sighting.species.slug %}">{{ sighting.species.common_name }}</a></li>
                        {% endfor %}
                </ul>
                {% endfor %}
        {% endifequal %}
        {% endwith %}
{% endwith %}

	<h2>Trip Rating</h2>
	{% if rating.on %}
	<p class="rating" title="{{ rating.on|length }} out of 5 stars">
	{% for i in rating.on %}
	<img src="/static/img/icons/starselect_single.gif" alt="">
	{% endfor %}
	{% for i in rating.off %}
	<img src="/static/img/icons/starselect_off.png" alt="">
	{% endfor %}
	</p>
	{% else %}
	<p>You haven't rated this trip yet, don't worry though, you can do this by editing the trip.</p>
	{% endif %}
	
{% endblock %}
